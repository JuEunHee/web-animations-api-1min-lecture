<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Starfield</title>
	<style>
		body {
			overflow: hidden;
			background-color: black;
		}

		.star {
			position: absolute;
			width: 3px;
			height: 3px;
			font-size: 0;
			border-radius: 50%;
			background: white;
		}
	</style>
</head>
<body>
	<div class="starfield"></div>

  <!-- GroupEffect, SequanceEffect 사용 가능한 라이브러리 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web-animations/2.3.2/web-animations-next.min.js"></script>
  <!--
    스타워즈 모듈 import 가능.
    모듈 사용 시 장점:
      - script영역에 직접 변수를 선언 시 글로벌 변수가 되는것에 비해,
      - 자체적으로 스코프가 생겨서 전역에서 접근이 안되는 점이 장점
  -->
	<script type="module">
    import Star from './Star.js';

    // 3차원 원근값 결정 : 별이 다가오면서 커지도록 위치에 따라 다시 결정되어야함
    function set3DPoint(x, y, z) {
      const scale = zModifier / (zModifier + z);

      // scale 자체가 z값에 따라 결정됨. 이 값에 맞게 x, y값도 변경하겠다는 것.
      const x2D = x * scale;
      const y2D = y * scale;

      return [x2D, y2D, scale]; // 3D가 아니라서 z값은 안넘겨줘도 됨
    }

    const numberOfStars = 200; // 별의 개수
    const zModifier = window.innerHeight; // 위치값을 계속 변경해줄거기때문에 변수로 빼줌
    const effects = [];

    let x, y, z; // 별의 위치 결정
    let scale; // 별의 크기 결정
    let keyframes, options;
    let pointFrom, pointTo;
    let star;

    for (let i = 0; i < numberOfStars; i++) {
      x = (Math.random() * window.innerWidth); // 브라우저 너비 안에서 세팅되도록
      y = (Math.random() * window.innerHeight); // 브라우저 높이 안에서 세팅되도록
      z = (Math.random() * zModifier);

      pointFrom = set3DPoint(x, y, z);
      pointTo = set3DPoint(x, y, z - zModifier); // -값이 될수록 가까워지는거니까, zModifier만큼 가까워지도록

      star = new Star(i);

      keyframes = [
        {
          transform: `
            translate(${pointFrom[0]}px, ${pointFrom[1]}px)
            scale(${pointFrom[2]})
          `
        },
        {
          transform: `
            translate(${pointTo[0]}px, ${pointTo[1]}px)
            scale(${pointTo[2]})
          `
        }
      ]

      options = {
        duration: 1000,
        iterations: Infinity,
        fill: 'both',
        easing: 'linear' // 가속 옵션 : 일정하게
      }

      console.log(keyframes)

      effects.push(new KeyframeEffect(star.element, keyframes, options));
    }

    const groupEffect = new GroupEffect(effects);
    const animation = document.timeline.play(groupEffect);
	</script>
</body>
</html>
